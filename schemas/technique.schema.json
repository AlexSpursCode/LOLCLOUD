{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://lolcloud.dev/schemas/technique.schema.json",
  "title": "TechniqueEntryV1",
  "type": "object",
  "required": [
    "id",
    "name",
    "provider",
    "service",
    "description",
    "attack_category",
    "mitre_attack",
    "example",
    "telemetry",
    "detection",
    "risk",
    "mitigation",
    "references",
    "status",
    "created_at",
    "updated_at"
  ],
  "additionalProperties": false,
  "properties": {
    "id": {
      "type": "string",
      "pattern": "^LC-(aws|azure|gcp)-[a-z0-9-]+$"
    },
    "name": { "type": "string", "minLength": 3 },
    "provider": { "type": "string", "enum": ["aws", "azure", "gcp"] },
    "service": { "type": "string", "minLength": 2 },
    "description": { "type": "string", "minLength": 10 },
    "attack_category": {
      "type": "string",
      "enum": [
        "identity_abuse",
        "control_plane",
        "serverless_abuse",
        "cicd_abuse",
        "data_exfil",
        "api_misuse"
      ]
    },
    "mitre_attack": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["tactic", "technique_id", "technique_name"],
        "additionalProperties": false,
        "properties": {
          "tactic": { "type": "string", "minLength": 2 },
          "technique_id": {
            "type": "string",
            "pattern": "^T[0-9]{4}(\\.[0-9]{3})?$"
          },
          "technique_name": { "type": "string", "minLength": 2 }
        }
      }
    },
    "example": {
      "type": "object",
      "required": ["type", "command_or_request"],
      "additionalProperties": false,
      "properties": {
        "type": { "type": "string", "enum": ["cli", "api"] },
        "command_or_request": { "type": "string", "minLength": 5 }
      }
    },
    "telemetry": {
      "type": "object",
      "required": [
        "required_logs",
        "minimum_config",
        "blind_spots",
        "retention_recommendation_days"
      ],
      "additionalProperties": false,
      "properties": {
        "required_logs": {
          "type": "array",
          "minItems": 2,
          "items": { "type": "string", "minLength": 2 }
        },
        "minimum_config": {
          "type": "array",
          "minItems": 1,
          "items": { "type": "string", "minLength": 2 }
        },
        "blind_spots": {
          "type": "array",
          "minItems": 1,
          "items": { "type": "string", "minLength": 2 }
        },
        "retention_recommendation_days": {
          "type": "integer",
          "minimum": 1,
          "maximum": 3650
        }
      }
    },
    "detection": {
      "type": "object",
      "required": [
        "hypotheses",
        "analytics",
        "false_positive_considerations"
      ],
      "additionalProperties": false,
      "properties": {
        "hypotheses": {
          "type": "array",
          "minItems": 2,
          "items": { "type": "string", "minLength": 5 }
        },
        "analytics": {
          "type": "array",
          "minItems": 1,
          "items": { "type": "string", "minLength": 5 }
        },
        "false_positive_considerations": {
          "type": "array",
          "minItems": 2,
          "items": { "type": "string", "minLength": 5 }
        }
      }
    },
    "risk": {
      "type": "object",
      "required": [
        "privilege_required",
        "ease_of_abuse",
        "impact",
        "detection_likelihood",
        "evasion_potential",
        "score",
        "severity"
      ],
      "additionalProperties": false,
      "properties": {
        "privilege_required": { "type": "integer", "minimum": 1, "maximum": 5 },
        "ease_of_abuse": { "type": "integer", "minimum": 1, "maximum": 5 },
        "impact": { "type": "integer", "minimum": 1, "maximum": 5 },
        "detection_likelihood": { "type": "integer", "minimum": 1, "maximum": 5 },
        "evasion_potential": { "type": "integer", "minimum": 1, "maximum": 5 },
        "score": { "type": "number", "minimum": 0.0, "maximum": 10.0 },
        "severity": {
          "type": "string",
          "enum": ["low", "medium", "high", "critical"]
        }
      }
    },
    "mitigation": {
      "type": "array",
      "minItems": 2,
      "items": { "type": "string", "minLength": 5 }
    },
    "references": {
      "type": "array",
      "minItems": 1,
      "items": { "type": "string", "format": "uri" }
    },
    "status": { "type": "string", "enum": ["draft", "reviewed", "verified"] },
    "created_at": { "type": "string", "format": "date-time" },
    "updated_at": { "type": "string", "format": "date-time" }
  }
}
